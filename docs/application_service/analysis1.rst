================================
MEDBIZ Platform 분석 기술
================================

.. contents:: 목차

-----
개요
-----
MEDBIZ Platform은 클라우드 형태의 가상파일 시스템 기술이 포함되어 있는데, 해당 가상 파일 시스템에 존재 하는 데이터를 기반으로한 결과 도출 기능을 지원하고 있음.

가상 파일 시스템을 기반으로 두가지 형태의 결과 도출 기능을 제공하고 있음

-----------------------------------------------------------------
JDL(Job Definition Language) 기반의 결과 도출
-----------------------------------------------------------------

JDL는 결과 도출을 위한 인터페이스로 어떠한 분석 모델과, 입력 값을을 통해 결과를 도출할 지에 대한 명명서이다.

JDL을 이용한 작업 절차는 아래 이미지와 같음

+----------------------------------------------------------+
|.. figure:: static/analysis/JDL_Base_Analysis_Process.png |
|    :width: 1600                                          |
+----------------------------------------------------------+

**아래는 JDL 명세서이다.**

.. code-block:: json

    {
        "outputs": ["작업 결과 파일 경로"],
        "resource": "작업 소스코드 경로",
        "inputs": ["작업에 필요한 기타 파일 경로"],
        "arguments": [
            "작업에 필요한 기타 인자"
        ],
        "ttl": "작업 유효 시간",
        "withCpu": "작업에 CPU 자원 활용 가능 여부",
        "withGpu": "작업에 GPU 자원 활용 가능 여부"
    }

위와 같이 resource, input, arguments, output의 4가지 구성요소를 갖는다.


**아래는 SPARK Create Submission 명세서이다.**

.. code-block:: json

    {
        "action": "CreateSubmissionRequest",
        "appArgs": [
            "JDL의 inputs, outputs, arguments 등 파라미터들이 매칭됨"
        ],
        "appResource": "JDL의 resource가 맵핑됨",
        "clientSparkVersion": "2.3.0",
        "environmentVariables": {
            "SPARK_ENV_LOADED": "6"
        },
        "mainClass": "org.apache.spark.deploy.SparkSubmit",
        "sparkProperties": {
            "executorMemory": "4g",
            "totalExecutorCores": "8",
            "spark.driver.supervise": "true",
            "spark.app.name": "Simple App",
            "spark.eventLog.enabled": "true",
            "spark.submit.deployMode": "cluster",
            "spark.master": "스파크 마스터 노드 정보"
        }
    }


VFS(Virtual File System) 클라우드 상위에서 JDL 이용방법
================================================================

    JDL 명세서를 JSON 포멧을 파일형태로 저장하고, VFS 클라우드 상에서 Analysis 기능을 이용해 작업을 할당함

- https://vfs.medbiz.or.kr 클라우드 페이지로 이동

+----------------------------------------------------------+
|.. figure:: static/analysis/vfs.medbiz.or.kr_homepage.png |
|    :width: 1600                                          |
+----------------------------------------------------------+

- 작업에 사용될 모델, 인풋 파일 데이터가 있다면 경로 정보, 아웃풋 파일 데이터가 있다면 경로 정보 등을 준비함

    - 모델 파일 segmentation.py
        (/home/public/AnalysisService/brain-segmentation/segmentation.py)
    - 인풋 데이터 경로 data
        (/home/public/AnalysisService/brain-segmentation/data/TCGA_HT_7877_19980917_23.png)
    - 아웃풋 경로
        (/home/public/AnalysisService/brain-segmentation/result.pdf)

+----------------------------------------------------------+
|.. figure:: static/analysis/vfs_jdl1.png                  |
|    :width: 1600                                          |
+----------------------------------------------------------+

- .jdl 형태의 파일 생성(빈파일을 생성하여 기입하여도 좋고, 로컬시스템에서 해당 내용을 작성하여서 업로드하여도 됨)

+----------------------------------------------------------+
|.. figure:: static/analysis/vfs_jdl2.png                  |
|    :width: 1600                                          |
+----------------------------------------------------------+

- 마우스 우클릭을 통해 해당 .jdl 파일에 명세된 작업을 수행시킴

+----------------------------------------------------------+
|.. figure:: static/analysis/vfs_jdl3.png                  |
|    :width: 1600                                          |
+----------------------------------------------------------+

- 작업 현황 패이지에서 해당 작업아 완료 되었는지, 상태는 어떤지에 대한 로깅 확인
    - https://commany.medbiz.or.kr/demo/ 페이지로 이동
    - 데이터 분석 >> 분석현황 >> 요청한 작업 목록 및 상태 조회 가능

+-----------------------------------------------+-----------------------------------------------+---------------------------------------------------+
|.. figure:: static/analysis/jdl_company_1.png  |.. figure:: static/analysis/jdl_company_2.png  |.. figure:: static/analysis/jdl_company_3.png      |
|    :width: 600                                |    :width: 600                                |    :width: 600                                    |
+-----------------------------------------------+-----------------------------------------------+---------------------------------------------------+

- 완료된 작업은 JDL 아웃풋 경로에 따라 결과물이 가상 파일 시스템에 저장 될 수 있음

+-----------------------------------------------+-----------------------------------------------+
|.. figure:: static/analysis/vfs_jdl4.png       |.. figure:: static/analysis/vfs_jdl5.png       |
|    :width: 800                                |    :width: 800                                |
+-----------------------------------------------+-----------------------------------------------+


기업용 페이지 > 데이터 분석 기능을 이용방법
================================================================

- 해당 페이지는 JDL 명세서를 웹 Form 형태로 구현한 페이지로, 적절한 입력값을 해당페이지를 통해 입력하여 JDL 파일을 생성하거나, 바로 작업을 요청할 수 있다.

- https://commany.medbiz.or.kr/demo/ 페이지로 이동

+----------------------------------------------------------+
|.. figure:: static/analysis/jdl_maker_1.png               |
|    :width: 1600                                          |
+----------------------------------------------------------+

- 기본적인 정보는 JDL과 동일하며, WEB Form 형태로 해당 내용을 옮겨 왔다는것이 차이점이다.

+----------------------------------------------------------+
|.. figure:: static/analysis/jdl_maker_2.png               |
|    :width: 1600                                          |
+----------------------------------------------------------+

- 인풋 및 리소스에 대하여 검색을 기능을 제공하며, 직접 입력 또한 가능하다.

- 해당 내용을 JDL 파일로 저장이 가능하며, 저장하지 않고 바로 실행을 요청할 수 있다.


샘플 서비스 이용한 방법
================================================================

- 웹 형태로 JDL기능을 랩핑한 어플리케이션으로, UI/UX 상에서 작업 방법과, 입력데이터를 선택하면 내부에서 JDL 형식으로 작업을 생성하고, 작업이 완료 되는데로 결과를 확인할 수 있는 페이지.

- :doc:`샘플 서비스 페이지 이동 <./healthcare_service>`

--------------------------------------------------
ETRI KSB(Bee AI) 연계, 결과 도출
--------------------------------------------------

Bee AI는 멀티 모달 데이터 처리, 동시학습 및 추론, 기계 학습 등이 가능하도록 설계 된 프레임워크이다.

Bee AI 프레임워크의 데이터 리소스로 MEDBIZ Platform의 API를 이용해 연계할 수 있도록 기술이 구현됨

- Bee Ai 개요
    - Bee Ai는 Medbiz platform에 연계되는 하나의 서비스로 볼 수 있음
    - 공개된 정보를 이용해 독자적으로 구축이 가능하며, OAuth 인증을 통해 Medbiz Platform의 사용자 본인 데이터에 접근이 가능하도록 할 수 있음

Bee-AI 이용 방법
================================================================

+----------------------------------------------------------+
|.. figure:: static/analysis/bee-ai-0.png                  |
|    :width: 1600                                          |
+----------------------------------------------------------+

- 워크플로우 생성
    - 워크플로우 속성, Bee-AI의 워크플로우 속성으로 워크플로우 이름, 설명, 배치 여부, 디버그 로깅 여부, 실행타입, 소속 프로젝트 등의 정보 기입
    - 엔진 선택, 처리를 위한 엔진 정보
    - Reader, 데이터의 리소스로 MEDBIZ Platform 클라우드 저장소 선택 가능
    - Writer, 데이터 아웃풋으로 MEDBIZ Platform 클라우드 저장소 선택 가능
    - Operator, 처리를 수행에 대한 정보로 클러스터수, 반복회수 등을 선택 가능

+----------------------------------------------------------+
|.. figure:: static/analysis/bee-ai-1.png                  |
|    :width: 1600                                          |
+----------------------------------------------------------+

+-----------------------------------------------+-----------------------------------------------+---------------------------------------------------+
|.. figure:: static/analysis/bee-ai-2.png       |.. figure:: static/analysis/bee-ai-3.png       |.. figure:: static/analysis/bee-ai-4.png           |
|    :width: 600                                |    :width: 600                                |    :width: 600                                    |
+-----------------------------------------------+-----------------------------------------------+---------------------------------------------------+
|.. figure:: static/analysis/bee-ai-5.png       |.. figure:: static/analysis/bee-ai-6.png       |.. figure:: static/analysis/bee-ai-7.png           |
|    :width: 600                                |    :width: 600                                |    :width: 600                                    |
+-----------------------------------------------+-----------------------------------------------+---------------------------------------------------+

Bee Ai 에 대한 좀더 자세한 내용은 해당 사이트 참조 바람